\section{Тестирование результатов}

В OpenJDK есть огромное количество тестов, в достаточно полной мере тестирующие все аспекты системы, однако их применение невозможно на данном этапе разработки, в связи с тем, что порт ещё не дописан и не может до конца проинициализировать JVM, необходимую для корректной работы тестов.
Даже если сделать обходной путь для запуска этих тестов, то невозможно будет оценить результаты тестирования и каждый проваленный тест будет требовать отдельного и тщательного изучения, что потребует слишком большого количества времени.

В связи с данными ограничениями приходилось прибегать к дополнительным методам тестирования, о которых и будет рассказано в данной главе.



\subsection{Объект тестирования}

В данной работе были рассмотрены темы, посвященные настройке окружения, структуре и генерации фреймов, а также выбору регистров для кэширования. Последняя тема не может быть протестирована в связи со своей спецификой и теоретической направленностью. Все теоретические выкладки были обоснованы и подкреплены статистикой, а практическая реализация незамысловата и влияет на всё поведение интерпретатора, что не поддается точечному тестированию. Настройка окружения также не поддается и не нуждается в тестировании, а доказательством её корректности можно считать рабочий zero порт. В связи с этим, основным объектом тестирования в данной работе являлись фреймы, их корректное заполнение, и, в частности, корректная передача аргументов.

Особое внимание необходимо уделить тестированию передачи аргументов в вызовы. В частности, важна полнота тестирования передачи аргументов в нативных вызовах, так как это самая платформозависимая и сложная часть, в которой может быть множество крайних случаев в последовательности аргументов и их значениях.


\subsection{Этапы тестирования}
% 1289

Помимо написания тестов, в разных частях интерпретатора стоят всевозможные отладочные проверки, которые показывают, что состояние последнего фрейма не испорчено. Это достигается путем записывание специальных значений в поля фрейма и их дальнейшей проверки. Данные проверки, в первую очередь, направлены на тестирование корректности выкладывания и снятия фреймов со стека.

Чтобы проверить корректность выкладывания аргументов был использован и переписан под наши нужды генератор программ на Java с использованием JNI вызовов, в котором происходил вызов каждой функции с определенной сигнатурой и подстановкой случайных аргументов, их дальнейшая проверка внутри этой функции и вызовом следующей. Таким образом было сгенерировано 1289 тестов, в каждом из которых было несколько вызовов ненативных и нативных функций, что позволило увеличить полноту тестирования заполнения различных сигнатур функций. Для тестирования с помощью данного способа были написаны обходные пути, позволяющие исполнять эти тесты без полной инициализации JVM, так как они не весьма ограниченных возможностей интерпретатора.

Дополнительно был использован скрипт по генерации случайных арифметических вычислений, написанный моими сокомандниками. Несмотря на направленность данного скрипта на тестирование арифметики, он также и проверяет корректность работы с локалами на стеке, которых генерируется огромное множество.

Также показательным является успешное прохождение инициализации части JVM, а именно более 130 тысяч байткодов и \TODO{>3070} методов. Данные показатели - это небольшой процент от общего числа вычислений, однако эта цифра упирается не в ошибки вычислений, а в неимплементированные части интерпретатора, поэтому нужно оценивать данные числа в абсолютном значении. Данная статистика показывает, что при стандартных путях исполнения программы создание, удаление и использование фреймов происходит безошибочно, с прохождением всех отладочных проверочных механизмов.



\subsection{Выводы}

Тестирование OpenJDK на ранних этапах является трудной задачей, в связи с не полностью рабочей функциональностью порта и отсутствием возможности запускать полноценные тесты. Однако в таких условиях было успешно сгенерировано и пройдено 1289 тестов на различные сигнатуры методов и передачу параметров, а также множестве случайных арифметических тестов, работающих с локалами на фреймах, а также фреймы были протестированы в реальных условиях работы интерпретатора.



